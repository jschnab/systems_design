{% extends 'base.html' %}

{% block content %}
    {% if new_text_id %}
        <div id="new-text-message" >
            Successfully stored new text!
            <input type="hidden" id="new-text-url" value="{{ app_url + url_for('get_text', text_id=new_text_id) }}">
            <button id="copy-new-text-url">
                <svg fill="#000000" width="1em" height="1em" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="m12.922 16.587-3.671 3.671c-.693.645-1.626 1.041-2.651 1.041-2.152 0-3.896-1.744-3.896-3.896 0-1.025.396-1.958 1.043-2.654l-.002.002 3.671-3.671c.212-.23.341-.539.341-.878 0-.717-.582-1.299-1.299-1.299-.339 0-.647.13-.879.342l.001-.001-3.671 3.671c-1.108 1.162-1.789 2.74-1.789 4.476 0 3.586 2.907 6.494 6.494 6.494 1.738 0 3.316-.683 4.482-1.795l-.003.002 3.671-3.671c.212-.23.341-.539.341-.878 0-.717-.582-1.299-1.299-1.299-.339 0-.647.13-.879.342l.001-.001z"/><path d="m24.007 6.489c-.002-3.585-2.908-6.491-6.494-6.491-1.793 0-3.417.727-4.592 1.902l-3.671 3.671c-.259.238-.421.579-.421.958 0 .717.582 1.299 1.299 1.299.379 0 .719-.162.957-.42l.001-.001 3.671-3.671c.693-.645 1.626-1.041 2.651-1.041 2.152 0 3.896 1.744 3.896 3.896 0 1.025-.396 1.958-1.043 2.654l.002-.002-3.671 3.671c-.259.238-.421.579-.421.958 0 .717.582 1.299 1.299 1.299.379 0 .719-.162.957-.42l.001-.001 3.671-3.671c1.178-1.169 1.908-2.789 1.908-4.58 0-.003 0-.006 0-.009z"/><path d="m7.412 16.592c.235.235.559.38.918.38s.683-.145.918-.38l7.342-7.342c.212-.23.341-.539.341-.878 0-.717-.582-1.299-1.299-1.299-.339 0-.647.13-.879.342l.001-.001-7.342 7.342c-.235.235-.38.559-.38.918s.145.683.38.918z"/>
                </svg>
            </button>
            <a href="{{ url_for('get_text', text_id=new_text_id) }}" target="_blank">
                <svg height="1em" width="1em" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 0h48v48H0z" fill="none"/>
                        <g>
                            <polygon points="40,38 8,38 8,10 20,10 20,6 4,6 4,42 44,42 44,30 40,30"/>
                            <polygon points="26,6 26,10 37.172,10 23.172,24 26,26.828 40,12.828 40,24 44,24 44,6"/>
                        </g>
                </svg>
            </a>
        </div>
    {% endif %}

    <div id="editable" class="editable" contenteditable="true">
        <span id="editable-placeholder">Paste contents here (up to 512,000 characters)</span>
    </div>
    <form method="post" action="{{ url_for('index') }}" onsubmit="return getContent()">
        <label for="text-title">Title</label>
        <input
            name="text-title"
            id="text-title"
            maxlength="60"
            minlength="10"
            placeholder="10 to 60 characters"
        >
        <textarea name="text-body" id="text-body" style="display:none"></textarea>
        <label for="ttl">Expire after</label>
        <select name="ttl" id="ttl">
            <option value="1d">1 day</option>
            <option value="1w">1 week</option>
            <option value="1m">1 month</option>
            <option value="1y">1 year</option>
        </select>
        <input type="submit" value="Store text">
    </form>

    <script>
        document.addEventListener(
            "DOMContentLoaded",
            function(e) {
                var editable = document.getElementById("editable");
                editable.onclick = function() {
                    editable.innerHTML = "";
                    editable.onclick = null;
                }
            }
        )

        var copyButton = document.getElementById("copy-new-text-url");
        if (copyButton !== null) {
            copyButton.addEventListener(
                "click",
                function() {
                    navigator.clipboard.writeText(
                        document.getElementById("new-text-url").value
                    );
                }
            )
        }

        function getContent() {
            console.log("start getContent");
            document.getElementById("text-body").value = document.getElementById("editable").innerHTML;
            console.log("finish getContent");
        }
    </script>
{% endblock %}
